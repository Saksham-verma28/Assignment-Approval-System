<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal Dashboard</title>
    <script type="module" src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
      <script src="https://unpkg.com/lucide@latest"></script> 
    <link rel="stylesheet" href="/css/adminDashboard.css">
    <link rel="stylesheet" href="/css/sidebar.css">
</head>

<body class="antialiased">

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, onSnapshot, collection, query, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        setLogLevel('debug');

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db = null;
        let auth = null;
        let userId = null;

        if (firebaseConfig) {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        document.getElementById('user-id-display').textContent = `User ID: ${userId}`;
                        console.log("Authenticated with UID:", userId);
                    } else {
                        if (initialAuthToken) {
                            await signInWithCustomToken(auth, initialAuthToken);
                        } else {
                            await signInAnonymously(auth);
                        }
                    }
                });

                document.getElementById('logout-btn').addEventListener('click', async () => {
                    try {
                        await signOut(auth);
                        console.log("User signed out.");
                        const mainContent = document.getElementById('main-content');
                        if (mainContent) {
                            mainContent.innerHTML = '<div style="text-align: center; padding: 3rem; font-size: 1.5rem; font-weight: 600; color: rgba(255,255,255,0.8);">You have been logged out.</div>';
                        }
                    } catch (error) {
                        console.error("Error signing out:", error);
                    }
                });
                
                window.toggleMobileMenu = () => {
                    document.getElementById('mobile-nav').classList.toggle('open');
                    document.getElementById('menu-icon').classList.toggle('hidden');
                    document.getElementById('close-icon').classList.toggle('hidden');
                };

            } catch (e) {
                console.error("Firebase initialization failed:", e);
            }
        } else {
            console.warn("Firebase configuration not available. Running in UI mode only.");
            document.getElementById('user-id-display').textContent = `User ID: UNAUTHENTICATED (UI only)`;
            window.toggleMobileMenu = () => {
                document.getElementById('mobile-nav').classList.toggle('open');
                document.getElementById('menu-icon').classList.toggle('hidden');
                document.getElementById('close-icon').classList.toggle('hidden');
            };
        }
    </script>


         <%- include('../partials/sidebar') %>

    <div id="main-content">
        
        <div class="dashboard-header">
            <h2>Dashboard Overview</h2>
            <p>Quick summary of the academic portal statistics.</p>
        </div>

        <div class="card-grid">

            <div class="card departments">
                <div class="card-title">TOTAL DEPARTMENTS</div>
                <div class="card-value"><%= dept %></div>
                <i data-lucide="building-2"></i>
                <div class="card-border"></div>
            </div>

            <div class="card students">
                <div class="card-title">TOTAL STUDENTS</div>
                <div class="card-value"><%= user %></div>
                <i data-lucide="user-check"></i>
                <div class="card-border"></div>
            </div>

            <div class="card professors">
                <div class="card-title">TOTAL PROFESSORS</div>
                <div class="card-value">0</div>
                <i data-lucide="graduation-cap"></i>
                <div class="card-border"></div>
            </div>

            <div class="card hods">
                <div class="card-title">TOTAL HODs</div>
                <div class="card-value">0</div>
                <i data-lucide="briefcase"></i>
                <div class="card-border"></div>
            </div>

        </div>
        <div class="activity-section">
            <h3>Recent Activity (Placeholder)</h3>
            <p>This area is reserved for charts, logs, or recent administrative actions.</p>
        </div>

    </div>
    <script src="/js/active.js"></script>
    <script>
        
        lucide.createIcons();
    </script>
</body>
</html>